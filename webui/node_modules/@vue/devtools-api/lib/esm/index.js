import { getTarget, getDevtoolsGlobalHook, isProxyAvailable } from '@vue/devtools-api/lib/esm/env.d.ts';
import { HOOK_SETUP } from '@vue/devtools-api/lib/esm/const.d.ts';
import { ApiProxy } from '@vue/devtools-api/lib/esm/proxy.d.ts';
export * from '@vue/devtools-api/lib/cjs/api';
export * from '@vue/devtools-api/lib/esm/plugin.d.ts';
export * from '@vue/devtools-api/lib/esm/time.d.ts';
export function setupDevtoolsPlugin(pluginDescriptor, setupFn) {
    const descriptor = pluginDescriptor;
    const target = getTarget();
    const hook = getDevtoolsGlobalHook();
    const enableProxy = isProxyAvailable && descriptor.enableEarlyProxy;
    if (hook && (target.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__ || !enableProxy)) {
        hook.emit(HOOK_SETUP, pluginDescriptor, setupFn);
    }
    else {
        const proxy = enableProxy ? new ApiProxy(descriptor, hook) : null;
        const list = target.__VUE_DEVTOOLS_PLUGINS__ = target.__VUE_DEVTOOLS_PLUGINS__ || [];
        list.push({
            pluginDescriptor: descriptor,
            setupFn,
            proxy,
        });
        if (proxy)
            setupFn(proxy.proxiedTarget);
    }
}
